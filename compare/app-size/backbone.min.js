var app=app||{};var ENTER_KEY=13;$(function(){"use strict";new app.AppView});var app=app||{};(function(){"use strict";var t=Backbone.Collection.extend({model:app.Todo,localStorage:new Backbone.LocalStorage("todos-backbone"),completed:function(){return this.filter(function(t){return t.get("completed")})},remaining:function(){return this.without.apply(this,this.completed())},nextOrder:function(){if(!this.length){return 1}return this.last().get("order")+1},comparator:function(t){return t.get("order")}});app.todos=new t})();var app=app||{};(function(){"use strict";app.Todo=Backbone.Model.extend({defaults:{title:"",completed:false},toggle:function(){this.save({completed:!this.get("completed")})}})})();var app=app||{};(function(){"use strict";var t=Backbone.Router.extend({routes:{"*filter":"setFilter"},setFilter:function(t){app.TodoFilter=t||"";app.todos.trigger("filter")}});app.TodoRouter=new t;Backbone.history.start()})();var app=app||{};(function(t){"use strict";app.AppView=Backbone.View.extend({el:"#todoapp",statsTemplate:_.template(t("#stats-template").html()),events:{"keypress #new-todo":"createOnEnter","click #clear-completed":"clearCompleted","click #toggle-all":"toggleAllComplete"},initialize:function(){this.allCheckbox=this.$("#toggle-all")[0];this.$input=this.$("#new-todo");this.$footer=this.$("#footer");this.$main=this.$("#main");this.listenTo(app.todos,"add",this.addOne);this.listenTo(app.todos,"reset",this.addAll);this.listenTo(app.todos,"change:completed",this.filterOne);this.listenTo(app.todos,"filter",this.filterAll);this.listenTo(app.todos,"all",this.render);app.todos.fetch({reset:true})},render:function(){var t=app.todos.completed().length;var e=app.todos.remaining().length;if(app.todos.length){this.$main.show();this.$footer.show();this.$footer.html(this.statsTemplate({completed:t,remaining:e}));this.$("#filters li a").removeClass("selected").filter('[href="#/'+(app.TodoFilter||"")+'"]').addClass("selected")}else{this.$main.hide();this.$footer.hide()}this.allCheckbox.checked=!e},addOne:function(e){var i=new app.TodoView({model:e});t("#todo-list").append(i.render().el)},addAll:function(){this.$("#todo-list").html("");app.todos.each(this.addOne,this)},filterOne:function(t){t.trigger("visible")},filterAll:function(){app.todos.each(this.filterOne,this)},newAttributes:function(){return{title:this.$input.val().trim(),order:app.todos.nextOrder(),completed:false}},createOnEnter:function(t){if(t.which!==ENTER_KEY||!this.$input.val().trim()){return}app.todos.create(this.newAttributes());this.$input.val("")},clearCompleted:function(){_.invoke(app.todos.completed(),"destroy");return false},toggleAllComplete:function(){var t=this.allCheckbox.checked;app.todos.each(function(e){e.save({completed:t})})}})})(jQuery);var app=app||{};(function(t){"use strict";app.TodoView=Backbone.View.extend({tagName:"li",template:_.template(t("#item-template").html()),events:{"click .toggle":"toggleCompleted","dblclick label":"edit","click .destroy":"clear","keypress .edit":"updateOnEnter","blur .edit":"close"},initialize:function(){this.listenTo(this.model,"change",this.render);this.listenTo(this.model,"destroy",this.remove);this.listenTo(this.model,"visible",this.toggleVisible)},render:function(){this.$el.html(this.template(this.model.toJSON()));this.$el.toggleClass("completed",this.model.get("completed"));this.toggleVisible();this.$input=this.$(".edit");return this},toggleVisible:function(){this.$el.toggleClass("hidden",this.isHidden())},isHidden:function(){var t=this.model.get("completed");return!t&&app.TodoFilter==="completed"||t&&app.TodoFilter==="active"},toggleCompleted:function(){this.model.toggle()},edit:function(){this.$el.addClass("editing");this.$input.focus()},close:function(){var t=this.$input.val().trim();this.$input.val(t);if(t){this.model.save({title:t})}else{this.clear()}this.$el.removeClass("editing")},updateOnEnter:function(t){if(t.which===ENTER_KEY){this.close()}},clear:function(){this.model.destroy()}})})(jQuery);