/* Riot v2.2.2-beta, @license MIT, (c) 2015 Muut Inc. + contributors */
(function(e){"use strict";var t={version:"v2.2.2-beta",settings:{}};var n="string";var i="object";var r=Array.isArray||function(){var e=Object.prototype.toString;return function(t){return e.call(t)==="[object Array]"}}();var o=function(e){return(e&&e.document||{}).documentMode|0}(e);t.observable=function(e){e=e||{};var t={},n=0;e.on=function(i,r){if(b(r)){r._id=typeof r._id=="undefined"?n++:r._id;i.replace(/\S+/g,function(e,n){(t[e]=t[e]||[]).push(r);r.typed=n>0})}return e};e.off=function(n,i){if(n=="*")t={};else{n.replace(/\S+/g,function(e){if(i){var n=t[e];for(var r=0,o;o=n&&n[r];++r){if(o._id==i._id){n.splice(r,1);r--}}}else{t[e]=[]}})}return e};e.one=function(t,n){function i(){e.off(t,i);n.apply(e,arguments)}return e.on(t,i)};e.trigger=function(n){var i=[].slice.call(arguments,1),r=t[n]||[];for(var o=0,u;u=r[o];++o){if(!u.busy){u.busy=1;u.apply(e,u.typed?[n].concat(i):i);if(r[o]!==u){o--}u.busy=0}}if(t.all&&n!="all"){e.trigger.apply(e,["all",n].concat(i))}return e};return e};t.mixin=function(){var e={};return function(t,n){if(!n)return e[t];e[t]=n}}();(function(e,t,n){if(!n)return;var i=n.location,r=e.observable(),o=n,u=false,f;function a(){return i.href.split("#")[1]||""}function s(e){return e.split("/")}function c(e){if(e.type)e=a();if(e!=f){r.trigger.apply(null,["H"].concat(s(e)));f=e}}var l=e.route=function(e){if(e[0]){i.hash=e;c(e)}else{r.on("H",e)}};l.exec=function(e){e.apply(null,s(a()))};l.parser=function(e){s=e};l.stop=function(){if(!u)return;o.removeEventListener?o.removeEventListener(t,c,false):o.detachEvent("on"+t,c);r.off("*");u=false};l.start=function(){if(u)return;o.addEventListener?o.addEventListener(t,c,false):o.attachEvent("on"+t,c);u=true};l.start()})(t,"hashchange",e);var u=function(e){var n,i,r,o=/[{}]/g;return function(u){var f=t.settings.brackets||e;if(n!==f){n=f;r=f.split(" ");i=r.map(function(e){return e.replace(/(?=.)/g,"\\")})}return u instanceof RegExp?f===e?u:new RegExp(u.source.replace(o,function(e){return i[~~(e==="}")]}),u.global?"g":""):r[u]}}("{ }");var f=function(){var t={},n=/(['"\/]).*?[^\\]\1|\.\w*|\w*:|\b(?:(?:new|typeof|in|instanceof) |(?:this|true|false|null|undefined)\b|function *\()|([a-z_$]\w*)/gi;return function(e,n){return e&&(t[e]=t[e]||i(e))(n)};function i(e,t){e=(e||u(0)+u(1)).replace(u(/\\{/g),"￰").replace(u(/\\}/g),"￱");t=f(e,a(e,u(/{/),u(/}/)));return new Function("d","return "+(!t[0]&&!t[2]&&!t[3]?r(t[1]):"["+t.map(function(e,t){return t%2?r(e,true):'"'+e.replace(/\n/g,"\\n").replace(/"/g,'\\"')+'"'}).join(",")+'].join("")').replace(/\uFFF0/g,u(0)).replace(/\uFFF1/g,u(1))+";")}function r(e,t){e=e.replace(/\n/g," ").replace(u(/^[{ ]+|[ }]+$|\/\*.+?\*\//g),"");return/^\s*[\w- "']+ *:/.test(e)?"["+a(e,/["' ]*[\w- ]+["' ]*:/,/,(?=["' ]*[\w- ]+["' ]*:)|}|$/).map(function(e){return e.replace(/^[ "']*(.+?)[ "']*: *(.+?),? *$/,function(e,t,n){return n.replace(/[^&|=!><]+/g,o)+'?"'+t+'":"",'})}).join("")+'].join(" ").trim()':o(e,t)}function o(t,i){t=t.trim();return!t?"":"(function(v){try{v="+(t.replace(n,function(t,n,i){return i?"(d."+i+"===undefined?"+(typeof e=="undefined"?"global.":"window.")+i+":d."+i+")":t})||"x")+"}catch(e){"+"}finally{return "+(i===true?'!v&&v!==0?"":v':"v")+"}}).call(d)"}function f(e,t){var n=[];t.map(function(t,i){i=e.indexOf(t);n.push(e.slice(0,i),t);e=e.slice(i+t.length)});return n.concat(e)}function a(e,t,n){var i,r=0,o=[],u=new RegExp("("+t.source+")|("+n.source+")","g");e.replace(u,function(t,n,u,f){if(!r&&n)i=f;r+=n?1:-1;if(!r&&u!=null)o.push(e.slice(i,f+u.length))});return o}}();function a(e){var t=u(0),n=e.slice(t.length).match(/^\s*(\S+?)\s*(?:,\s*(\S+))?\s+in\s+(.+)$/);return n?{key:n[1],pos:n[2],val:t+n[3]}:{val:e}}function s(e,t,n){var i={};i[e.key]=t;if(e.pos)i[e.pos]=n;return i}function c(e,t,n){y(e,"each");var i=e.outerHTML,o=e.parentNode,u=document.createComment("riot placeholder"),c=[],l=D(e),p;o.insertBefore(u,e);n=a(n);t.one("premount",function(){if(o.stub)o=t.root;e.parentNode.removeChild(e)}).on("update",function(){var a=f(n.val,t),g;if(!r(a)){p=a?JSON.stringify(a):"";a=!a?[]:Object.keys(a).map(function(e){return s(n,e,a[e])})}var v=document.createDocumentFragment(),m=c.length,h=a.length;while(m>h)c[--m].unmount();c.length=h;g=!p&&!!n.key;for(m=0;m<h;++m){var b=g?s(n,a[m],m):a[m];if(!c[m]){(c[m]=new d({tmpl:i},{parent:t,isLoop:true,root:o,item:b})).mount();v.appendChild(c[m].root)}else{c[m].update(b)}c[m]._item=b}o.insertBefore(v,u);if(l)t.tags[L(e)]=c}).one("updated",function(){var e=Object.keys(t);T(o,function(n){if(n.nodeType==1&&!n.isLoop&&!n._looped){n._visited=false;n._looped=true;H(n,t,e)}})})}function l(e,t,n){T(e,function(e){if(e.nodeType==1){e.isLoop=e.parentNode&&e.parentNode.isLoop||e.getAttribute("each")?1:0;var i=D(e);if(i&&!e.isLoop){var o=new d(i,{root:e,parent:t},e.innerHTML),u=L(e),f=t,a;while(!D(f.root)){if(!f.parent)break;f=f.parent}o.parent=f;a=f.tags[u];if(a){if(!r(a))f.tags[u]=[a];f.tags[u].push(o)}else{f.tags[u]=o}e.innerHTML="";n.push(o)}if(!e.isLoop)H(e,t,[])}})}function p(e,t,n){function i(e,t,i){if(t.indexOf(u(0))>=0){var r={dom:e,expr:t};n.push(_(r,i))}}T(e,function(e){var n=e.nodeType;if(n==3&&e.parentNode.tagName!="STYLE")i(e,e.nodeValue);if(n!=1)return;var r=e.getAttribute("each");if(r){c(e,t,r);return false}h(e.attributes,function(t){var n=t.name,r=n.split("__")[1];i(e,t.value,{attr:r||n,bool:r});if(r){y(e,n);return false}});if(D(e))return false})}function d(e,n,i){var o=t.observable(this),a=S(n.opts)||{},s=C(e.tmpl),c=n.parent,d=n.isLoop,g=n.item,v=[],b=[],y=n.root,L=e.fn,T=y.tagName.toLowerCase(),N={},A=[],H,O=/([\w\-]+)\s?=\s?['"]([^'"]+)["']/gim;if(L&&y._tag){y._tag.unmount(true)}this.isMounted=false;if(e.attrs){var j=e.attrs.match(O);h(j,function(e){var t=e.split(/\s?=\s?/);y.setAttribute(t[0],t[1].replace(/['"]/g,""))})}y._tag=this;this._id=w(~~((new Date).getTime()*Math.random()));_(this,{parent:c,root:y,opts:a,tags:{}},g);h(y.attributes,function(e){var t=e.value;if(u(/\{.*\}/).test(t))N[e.name]=t});if(s.innerHTML&&!/select|select|optgroup|tbody|tr/.test(T))s.innerHTML=x(s.innerHTML,i);function k(){h(y.attributes,function(e){a[e.name]=f(e.value,c||o)});h(Object.keys(N),function(e){a[e]=f(N[e],c||o)})}function E(e){for(var t in g){if(typeof o[t]!="undefined")o[t]=e[t]}}function F(){if(!o.parent||!d)return;h(Object.keys(o.parent),function(e){var t=~A.indexOf(e);if(typeof o[e]=="undefined"||t){if(!t)A.push(e);o[e]=o.parent[e]}})}this.update=function(e){F();if(g&&JSON.stringify(g)!=JSON.stringify(e)){E(e);g=e}_(o,e);k();o.trigger("update",e);m(v,o,e);o.trigger("updated")};this.mixin=function(){h(arguments,function(e){e=typeof e=="string"?t.mixin(e):e;h(Object.keys(e),function(t){if(t!="init")o[t]=typeof e[t]=="function"?e[t].bind(o):e[t]});if(e.init)e.init.bind(o)()})};this.mount=function(){k();L&&L.call(o,a);$(true);p(s,o,v);if(!o.parent||d)o.update(g);o.trigger("premount");if(d){o.root=y=H=s.firstChild}else{while(s.firstChild)y.appendChild(s.firstChild);if(y.stub)o.root=y=c.root}if(!o.parent||o.parent.isMounted){o.isMounted=true;o.trigger("mount")}else o.parent.one("mount",function(){if(!M(o.root)){o.parent.isMounted=o.isMounted=true;o.trigger("mount")}})};this.unmount=function(e){var t=H||y,n=t.parentNode;if(n){if(c)if(r(c.tags[T]))h(c.tags[T],function(e,t){if(e._id==o._id)c.tags[T].splice(t,1)});else c.tags[T]=undefined;else while(t.firstChild)t.removeChild(t.firstChild);if(!e)n.removeChild(t)}o.trigger("unmount");$();o.off("*");y._tag=null};function $(e){h(b,function(t){t[e?"mount":"unmount"]()});if(c){var t=e?"on":"off";if(d)c[t]("unmount",o.unmount);else c[t]("update",o.update)[t]("unmount",o.unmount)}}l(s,this,b)}function g(t,n,i,r,o){i[t]=function(t){t=t||e.event;try{if(!t.which)t.which=t.charCode||t.keyCode;if(!t.target)t.target=t.srcElement;t.currentTarget=i}catch(u){""}t.item=r._item?r._item:o;if(n.call(r,t)!==true&&!/radio|check/.test(i.type)){t.preventDefault&&t.preventDefault();t.returnValue=false}if(!t.preventUpdate){var f=o?r.parent:r;f.update()}}}function v(e,t,n){if(e){e.insertBefore(n,t);e.removeChild(t)}}function m(e,t,n){h(e,function(e,i){var r=e.dom,o=e.attr,u=f(e.expr,t),a=e.dom.parentNode;if(u==null)u="";if(a&&a.tagName=="TEXTAREA")u=u.replace(/riot-/g,"");if(e.value===u)return;e.value=u;if(!o)return r.nodeValue=u.toString();y(r,o);if(typeof u=="function"){g(o,u,r,t,n)}else if(o=="if"){var s=e.stub;if(u){if(s){v(s.parentNode,s,r);r.inStub=false;if(!M(r)){T(r,function(e){if(e._tag&&!e._tag.isMounted)e._tag.isMounted=!!e._tag.trigger("mount")})}}}else{s=e.stub=s||document.createTextNode("");v(r.parentNode,r,s);r.inStub=true}}else if(/^(show|hide)$/.test(o)){if(o=="hide")u=!u;r.style.display=u?"":"none"}else if(o=="value"){r.value=u}else if(o.slice(0,5)=="riot-"&&o!="riot-tag"){o=o.slice(5);u?r.setAttribute(o,u):y(r,o)}else{if(e.bool){r[o]=u;if(!u)return;u=o}if(typeof u!="object")r.setAttribute(o,u)}})}function h(e,t){for(var n=0,i=(e||[]).length,r;n<i;n++){r=e[n];if(r!=null&&t(r,n)===false)n--}return e}function b(e){return typeof e==="function"||false}function y(e,t){e.removeAttribute(t)}function w(e){return(e^e>>31)-(e>>31)}function L(e){var t=D(e),n=e.getAttribute("name"),i=n&&n.indexOf(u(0))<0?n:t.name;return i}function _(e){var t,n=arguments;for(var i=1;i<n.length;++i){if(t=n[i]){for(var r in t){e[r]=t[r]}}}return e}function C(e){var t=o&&o<10,n=/^\s*<([\w-]+)/.exec(e),i=n?n[1].toLowerCase():"",r=i==="th"||i==="td"?"tr":i==="tr"?"tbody":"div",u=N(r);u.stub=true;if(t){if(i==="optgroup")k(u,e);else if(i==="option")j(u,e);else if(r!=="div")O(u,e,i);else t=0}if(!t)u.innerHTML=e;return u}function T(e,t){if(e){if(t(e)===false)T(e.nextSibling,t);else{e=e.firstChild;while(e){T(e,t);e=e.nextSibling}}}}function M(e){while(e){if(e.inStub)return true;e=e.parentNode}return false}function N(e){return document.createElement(e)}function x(e,t){return e.replace(/<(yield)\/?>(<\/\1>)?/gim,t||"")}function A(e,t){return(t||document).querySelectorAll(e)}function S(e){function t(){}t.prototype=e;return new t}function H(e,t,n){h(e.attributes,function(i){if(e._visited)return;if(i.name==="id"||i.name==="name"){e._visited=true;var o,u=i.value;if(~n.indexOf(u))return;o=t[u];if(!o)t[u]=e;else r(o)?o.push(e):t[u]=[o,e]}})}function O(e,t,n){var i=N("div"),r=/td|th/.test(n)?3:2,o;i.innerHTML="<table>"+t+"</table>";o=i.firstChild;while(r--)o=o.firstChild;e.appendChild(o)}function j(e,t){var n=N("option"),i=/value=[\"'](.+?)[\"']/,r=/selected=[\"'](.+?)[\"']/,o=/each=[\"'](.+?)[\"']/,u=/if=[\"'](.+?)[\"']/,f=/>([^<]*)</,a=t.match(i),s=t.match(r),c=t.match(f),l=t.match(o),p=t.match(u);if(c)n.innerHTML=c[1];else n.innerHTML=t;if(a)n.value=a[1];if(s)n.setAttribute("riot-selected",s[1]);if(l)n.setAttribute("each",l[1]);if(p)n.setAttribute("if",p[1]);e.appendChild(n)}function k(e,t){var n=N("optgroup"),i=/label=[\"'](.+?)[\"']/,r=/^<([^>]*)>/,o=/^<([^ \>]*)/,u=t.match(i),f=t.match(r),a=t.match(o),s=t;if(f){var c=t.slice(f[1].length+2,-a[1].length-3).trim();s=c}if(u)n.setAttribute("riot-label",u[1]);if(s){var l=N("div");j(l,s);n.appendChild(l.firstChild)}e.appendChild(n)}var E=[],F={},$;var B="riot-tag";function D(e){return F[e.getAttribute(B)||e.tagName.toLowerCase()]}function R(e){$=$||N("style");if(!document.head)return;if($.styleSheet)$.styleSheet.cssText+=e;else $.innerHTML+=e;if(!$._rendered)if($.styleSheet){document.body.appendChild($)}else{var t=A("style[type=riot]")[0];if(t){t.parentNode.insertBefore($,t);t.parentNode.removeChild(t)}else document.head.appendChild($)}$._rendered=true}function J(e,t,n){var i=F[t],r=e._innerHTML=e._innerHTML||e.innerHTML;e.innerHTML="";if(i&&e)i=new d(i,{root:e,opts:n},r);if(i&&i.mount){i.mount();E.push(i);return i.on("unmount",function(){E.splice(E.indexOf(i),1)})}}t.tag=function(e,t,n,i,r){if(b(i)){r=i;if(/^[\w\-]+\s?=/.test(n)){i=n;n=""}else i=""}if(n){if(b(n))r=n;else R(n)}F[e]={name:e,tmpl:t,attrs:i,fn:r};return e};t.mount=function(e,t,r){var o,u,f=[];function a(e){var t="";h(e,function(e){t+=', *[riot-tag="'+e.trim()+'"]'});return t}function s(){var e=Object.keys(F);return e+a(e)}function c(e){if(e.tagName){if(t&&!e.getAttribute(B))e.setAttribute(B,t);var n=J(e,t||e.getAttribute(B)||e.tagName.toLowerCase(),r);if(n)f.push(n)}else if(e.length){h(e,c)}}if(typeof t===i){r=t;t=0}if(typeof e===n){if(e==="*")e=u=s();else e+=a(e.split(","));o=A(e)}else o=e;if(t==="*"){t=u||s();if(o.tagName)o=A(t,o);else{var l=[];h(o,function(e){l.push(A(t,e))});o=l}t=0}if(o.tagName)c(o);else h(o,c);return f};t.update=function(){return h(E,function(e){e.update()})};t.mountTo=t.mount;t.util={brackets:u,tmpl:f};if(typeof exports==="object")module.exports=t;else if(typeof define==="function"&&define.amd)define(function(){return e.riot=t});else e.riot=t})(typeof window!="undefined"?window:undefined);
